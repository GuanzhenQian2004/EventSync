{% extends "base.html" %}
{% block title %}Profile · EventSync{% endblock %}
{% block content %}
  <h1>Profile</h1>

  {% if user %}
    <p><strong>Email:</strong> {{ user.user_email }}</p>
    <p><strong>Name:</strong> {{ user.name }}</p>
    {% if phone1 %}
      <p><strong>Phone Number:</strong> {{ phone1 }}</p>
      {% if phone2%}
        <p><strong>Alternate Phone Number:</strong> {{ phone2 }}</p>
      {%endif%}
    {%endif%}
    <h2 style="margin-top:24px;">My Events</h2>

    {% if events_created and events_created|length > 0 %}
      <ul>
        {% for ev in events_created %}
          {# ev = (eid, event_name, date, start_time, org_name) #}
          <li style="margin-bottom:10px;">
            <a href="{{ url_for('event_detail', eid=ev[0]) }}">
              <strong>{{ ev[1] }}</strong>
              <span class="muted">
                · {{ ev[4] }}
                · {{ ev[2] }} {{ ev[3] }}
              </span>
            </a>

            {# Delete button: POST form to /events/<eid>/delete #}
            <form method="post"
                  action="{{ url_for('delete_event', eid=ev[0]) }}"
                  style="display:inline-block; margin-left:8px;"
                  onsubmit="return confirm('Are you sure you want to delete this event?');">
              <button type="submit" style="background:#c62828;">
                Delete
              </button>
            </form>

            {# Update button #}
              <form method="get"
                    action="{{ url_for('edit_event', eid=ev[0]) }}"
                    style="display:inline-block; margin-left:8px;"
                    >
                <button type="submit" style="background:#1c4db7;">
                  Update
                </button>
              </form>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">You haven’t created any events yet.</p>
    {% endif %}

    <h2 style="margin-top:24px;">My RSVP'ed Events</h2>

    {% if events_rsvp and events_rsvp|length > 0 %}
      <ul>
        {% for ev in events_rsvp %}
          {# ev = (eid, event_name, date, start_time, org_name) #}
          <li style="margin-bottom:10px;">
            <a href="{{ url_for('event_detail', eid=ev[0]) }}">
              <strong>{{ ev[1] }}</strong>
              <span class="muted">
                · {{ ev[4] }}
                · {{ ev[2] }} {{ ev[3] }}
              </span>
            </a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">You haven’t RSVP'ed to any events yet.</p>
    {% endif %}

    <h2 style="margin-top:24px;">My Organizations</h2>
    {% if joined_orgs and joined_orgs|length > 0 %}
      <ul>
        {% for org_name in joined_orgs %}
          <li>{{ org_name }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">You haven't joined any Organizations ... yet!</p>
    {% endif %}
    
  {% else %}
    <p class="muted">You’re not logged in.</p>
  {% endif %}
{% endblock %}
